<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scholarly Bookmarks</title>
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet">
  <link rel="stylesheet" href="assets/css/dashboard.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body>
  <div class="dashboard d-flex">
    <aside class="sidebar d-flex flex-column align-items-center p-3">
  <img src="assets/images/Group 44.png" alt="Scholarly Logo" class="logo mb-4 sidebar-logo">
  
  <div class="profile text-center mb-4">
    <img src="assets/Images/profile.png" alt="Profile" class="profile-img mb-2 big-circle">
    <h2 id="sidebarName" class="h5 fw-bold">Leonard Tariman</h2>
    <p class="small mb-2">STUDENT</p>
    <button class="btn btn-primary rounded-pill" onclick="window.location.href='edit.html'">Edit Profile</button>
  </div>

  <hr class="w-100">

  <nav class="nav flex-column w-100">
    <a href="dashboard.html" class="nav-link d-flex align-items-center gap-2 text-white active">
      <i class="bi bi-house-door"></i> Home
    </a>
    <a href="settings.html" class="nav-link d-flex align-items-center gap-2 text-white">
      <i class="bi bi-gear"></i> Settings
    </a>
    <a href="bookmark.html" class="nav-link d-flex align-items-center gap-2 text-white">
      <i class="bi bi-bookmark"></i> Bookmarks
    </a>
    <a href="logout.php" class="nav-link d-flex align-items-center gap-2 text-white" 
   data-bs-toggle="modal" data-bs-target="#logoutModal">
  <i class="bi bi-box-arrow-right"></i> Logout
</a>
  </nav>

  <button class="sidebar-toggle" id="sidebarToggle">
  <img src="assets/Images/left_arrow.png" alt="Toggle Sidebar" class="arrow-icon">
</button>
</aside>

    <main class="main-content flex-grow-1 p-4">
      <h2 class="fw-bold mb-4">Bookmarks</h2>
      <div id="bookmarkCards" class="cards d-flex flex-column gap-3"></div>
    </main>
  </div>

  <!-- Scholarship Detail Modal -->
  <div id="scholarshipModal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="scholarship-detail">
            <div class="scholarship-header d-flex align-items-center gap-3 mb-4">
              <img id="modalLogo" src="" alt="Logo" class="scholarship-logo">
              <div>
                <h2 id="modalTitle" class="scholarship-title mb-1"></h2>
                <p id="modalSponsor" class="scholarship-sponsor mb-0"></p>
              </div>
            </div>
            
            <div class="scholarship-content">
              <div class="eligibility-section mb-4">
                <h5 class="section-title text-primary mb-3">Eligibility</h5>
                <ul id="modalEligibility" class="eligibility-list"></ul>
              </div>
              
              <div class="benefits-section mb-4">
                <h5 class="section-title mb-3">
                  <span class="benefits-icon">ðŸŽ“</span> Benefits
                </h5>
                <ul id="modalBenefits" class="benefits-list"></ul>
              </div>
              
              <div class="requirements-section mb-4">
                <h5 class="section-title mb-3">
                  <span class="requirements-icon">âœ…</span> Application Requirements
                </h5>
                <ul id="modalRequirements" class="requirements-list"></ul>
              </div>
              
              <div class="scholarship-meta d-flex justify-content-between align-items-center mb-4">
                <div>
                  <strong>DATE OF EFFECT:</strong> <span id="modalDate"></span>
                </div>
                <div>
                  <strong>CONTACT & DETAILS:</strong> <span id="modalContact"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary btn-apply" id="applyBtn">APPLY</button>
        </div>
      </div>
    </div>
  </div>
<div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content logout-modal">
      <div class="modal-body text-center py-4">
        <i class="bi bi-box-arrow-right text-danger mb-3" style="font-size:3rem;"></i>
        <h5 class="fw-bold text-dark mb-2">Are you sure you want to log out?</h5>
        <p class="text-muted small">You will be redirected to the login page.</p>
        <div class="d-flex justify-content-center gap-3 mt-3">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <a href="logout.php" class="btn btn-danger px-4">Logout</a>
        </div>
      </div>
    </div>
  </div>
</div>
  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="user-hydrate.js.php"></script>
  <script>
document.addEventListener("DOMContentLoaded", function () {
  const currentPage = window.location.pathname.split("/").pop();
  const navLinks = document.querySelectorAll(".sidebar .nav-link");
  navLinks.forEach(link => {
    const href = link.getAttribute("href").split("/").pop();
    link.classList.toggle("active", href === currentPage);
  });

  const sidebar = document.querySelector(".sidebar");
  const toggleButton = document.getElementById("sidebarToggle");
  const profileImg = document.querySelector(".profile-img");

  toggleButton.addEventListener("click", function () {
    sidebar.classList.toggle("collapsed");
    profileImg.classList.toggle("small-profile", sidebar.classList.contains("collapsed"));
  });

  // âœ… Load bookmarks
  const wrap = document.getElementById("bookmarkCards");

  fetch("api-bookmarks.php", { credentials: "same-origin", cache: "no-store" })
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(items => {
      if (!Array.isArray(items) || items.length === 0) {
        const info = document.createElement("div");
        info.className = "alert alert-info text-center py-5";
        info.innerHTML = "<h4>No bookmarks yet</h4><p class='mb-0'>Start bookmarking scholarships to see them here!</p>";
        wrap.appendChild(info);
        return;
      }

      items.forEach(s => {
        const card = document.createElement("div");
        card.className = "card position-relative p-3 d-flex flex-row justify-content-between align-items-center";

        const img = document.createElement("img");
        img.src = s.image_path && s.image_path.length ? s.image_path : "assets/Images/image.png";
        img.alt = "logo";
        img.style.width = "80px";
        img.style.height = "80px";
        img.style.objectFit = "cover";

        const middle = document.createElement("div");
        const title = document.createElement("h5");
        title.textContent = s.title || "";
        const sponsor = document.createElement("p");
        sponsor.className = "text-muted mb-0";
        sponsor.textContent = s.sponsor || "";
        middle.appendChild(title);
        middle.appendChild(sponsor);

        const right = document.createElement("div");
        const bookmarkIcon = document.createElement("button");
        bookmarkIcon.className = "bookmark-icon bookmarked me-2";
        bookmarkIcon.onclick = function () {
          toggleBookmark(s.id, bookmarkIcon);
        };

        const btn = document.createElement("button");
        btn.className = "btn btn-primary btn-sm";
        btn.textContent = "VIEW";
        btn.onclick = function () {
          showScholarshipDetails(s.id);
        };

        right.appendChild(bookmarkIcon);
        right.appendChild(btn);

        card.appendChild(img);
        card.appendChild(middle);
        card.appendChild(right);
        wrap.appendChild(card);
      });
    })
    .catch(err => {
      console.error("Bookmark load failed:", err);
      wrap.innerHTML = `<div class="alert alert-danger text-center">Failed to load bookmarks.</div>`;
    });
});

// âœ… Toggle bookmark
function toggleBookmark(scholarshipId, iconElement) {
  fetch("api-bookmarks.php", {
    method: "POST",
    credentials: "same-origin",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ scholarship_id: scholarshipId, action: "toggle" })
  })
    .then(r => r.json())
    .then(data => {
      if (data.success && !data.bookmarked) {
        iconElement.closest(".card").remove();
        const wrap = document.getElementById("bookmarkCards");
        if (wrap.children.length === 0) {
          const info = document.createElement("div");
          info.className = "alert alert-info text-center py-5";
          info.innerHTML = "<h4>No bookmarks yet</h4><p class='mb-0'>Start bookmarking scholarships to see them here!</p>";
          wrap.appendChild(info);
        }
      }
    })
    .catch(console.error);
}

// âœ… View scholarship details
function showScholarshipDetails(scholarshipId) {
  fetch("api-scholarships.php?id=" + scholarshipId, { credentials: "same-origin" })
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(data => {
      document.getElementById("modalLogo").src = data.image_path || "assets/Images/image.png";
      document.getElementById("modalTitle").textContent = data.title || "";
      document.getElementById("modalSponsor").textContent = data.sponsor || "";
      document.getElementById("modalEligibility").innerHTML = data.description
        ? `<li>${data.description}</li>` : "<li>No description available</li>";
      document.getElementById("modalDate").textContent =
        data.start_date && data.end_date
          ? `${data.start_date} - ${data.end_date}`
          : "N/A";
      document.getElementById("modalContact").textContent =
        data.email || data.phone || "N/A";

      const applyBtn = document.getElementById("applyBtn");
      if (applyBtn) { applyBtn.style.display = "none"; }

      new bootstrap.Modal(document.getElementById("scholarshipModal")).show();
    })
    .catch(err => {
      console.error(err);
      alert("Failed to load scholarship details");
    });
}

// âœ… Submit application
function submitApplication() { /* disabled */ }
</script>
</body>
</html>